helpers:
  cr: &common-rules
    verbosity: error
  ckr: &common-kibana-rules
    access: rw
    hide_apps: [ "Enterprise Search|Overview", "Observability" ]
    index: ".kibana_@{acl:current_group}"
  ag: &all-groups
    groups:
      - id: admins_group
        name: administrators
      - id: infosec_group
        name: infosec
      - id: template_group
        name: template

readonlyrest:
  response_if_req_forbidden: Forbidden by ReadonlyREST ES plugin
  prompt_for_basic_auth: false

  audit:
    enabled: true
    outputs:
      - type: index
        index_template: "'readonlyrest_audit_'yyyy-MM-dd"

  access_control_rules:

    - name: "Kibana service account - user/pass"
      verbosity: error
      auth_key: kibana:kibana

    - name: "APM"
      type: allow
      auth_key: apm:test

    - name: PERSONAL_GRP
      groups: [ Personal ]
      <<: *common-rules
      kibana:
        <<: *common-kibana-rules
        index: '.kibana_@{user}'

    - name: ADMIN_GRP
      groups: [ admins_group ]
      <<: *common-rules
      kibana:
        <<: *common-kibana-rules
        access: admin
        metadata:
          alert_message: "Dear @{acl:user}"
    - name: infosec
      groups: [ infosec_group ]
      kibana:
        <<: *common-kibana-rules
        access: admin
        hide_apps: [ "Enterprise Search|Overview", "Observability", "Management" ]

    - name: Template Tenancy
      groups: [ template_group ]
      kibana:
        <<: *common-kibana-rules

    - name: "Reporting tests: user2"
      auth_key: user2:dev
      kibana:
        index: ".kibana_user2"
        access: rw
      indices: ["invoices"]

    - name: "Reporting tests: user3"
      auth_key: user3:dev
      kibana:
        index: ".kibana_user3"
        access: rw
      indices: ["invoices"]

  users:
    - username: admin
      auth_key: admin:dev
      <<: *all-groups

    - username: user1
      auth_key: user1:dev
      <<: *all-groups

  impersonation:
    - impersonator: admin
      users: ["*"]
      auth_key: admin:dev
